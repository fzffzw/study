####更新聚美订单跟踪号
update orders as o
inner join jmorders as jm
on o.reference_no=jm.reference_no
set o.ref_tracking_number=jm.tracking_number
where o.customer_code='C0286'

###更新新的网址
update customer set customer_logo_save_site=REPLACE(customer_logo_save_site, 'http://203.169.186.130', 'http://120.24.52.244') where customer_logo_save_site!=''

###更新菜鸟数据
update api_message set file_path=REPLACE(file_path, '/home/apache/www/import', '/var/www/html/import') where file_path!=''

###2015-02-25 处理大的数据 将ftp_message_shipbatch_order_log表中的老数据备份删除
##备份表数据
/usr/bin/mysqldump -u cargo -p import_wms -h xxx ftp_message_shipbatch_order_log >> /home/william/ftp_message_shipbatch_order_log.sql
添加数据 source xxx
删除数据
delete from ftp_message_shipbatch_order_log where fmso_id<=10411776 limit 500000


##更新产品重量
update product as p
inner join skuweight as  sw
on p.product_sku=sw.product_sku
set p.product_weight=sw.product_weight

##更新法定单位重量，注意要海关编码法定单位是kg的赛选出来
update hs_uom_map as hum 
inner join product as p
on hum.product_id=p.product_id
set hum.hum_quantity_law=p.product_weight
where p.product_sku in(
'DEHPH001',
'DEHPH002',
);



###导出报表
select tp2.ref_no,tmo.* from 
tmpref2 as tp2
left join
(
select fmso.form_id_xml,o.order_code,o.reference_no
from ftp_message_shipbatch_order as fmso
inner join orders as o
on o.order_code=fmso.order_code) as tmo
on tp2.ref_no=tmo.form_id_xml

##导出行邮税
select o.order_code,o.reference_no,p.product_sku,op.op_price as 单价,op.op_quantity as 数量,o.order_status,gts.gt_rate as 税率,fmso.fml_status 
from orders as o
inner join order_product as op
on o.order_code=op.order_code
inner join ftp_message_shipbatch_order as fmso
on fmso.order_code=o.order_code
inner join product as p
on p.product_id=op.product_id
inner join goods_tax as gts
on gts.gt_id=p.gt_id
where o.customer_code='C0286'
and o.add_time>='2015.4.10 16:54:00'


select o.order_code,o.reference_no,p.product_sku,op.op_price as 单价,op.op_quantity as 数量,op.op_price*op.op_quantity as totalvalue,op.op_price*op.op_quantity*gts.gt_rate as xys,o.order_status,gts.gt_rate as 税率,fmso.fml_status,sum(op.op_price*op.op_quantity*gts.gt_rate) as totalxys
from orders as o
inner join order_product as op
on o.order_code=op.order_code
inner join ftp_message_shipbatch_order as fmso
on fmso.order_code=o.order_code
inner join product as p
on p.product_id=op.product_id
inner join goods_tax as gts
on gts.gt_id=p.gt_id
where o.customer_code='C0286'
and fmso.fml_status='3'
group by o.order_code
having(totalxys)>=50





